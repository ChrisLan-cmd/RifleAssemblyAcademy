{% extends "layout.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">Each part of SAR21 - Quiz</h3>
                    <div class="float-end">Score: <span id="score">0</span></div>
                </div>
                <div class="card-body">
                    <img src="{{ image_url }}" alt="SAR21 Part" class="img-fluid mb-4" style="max-height: 300px;">
                    <div class="options-container">
                        {% for option in options %}
                        <button class="btn btn-outline-primary btn-lg w-100 mb-2 option-btn" data-answer="{{ option }}">
                            {{ option }}
                        </button>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const optionButtons = document.querySelectorAll('.option-btn');
    const scoreDisplay = document.getElementById('score');
    let currentScore = 0;

    optionButtons.forEach(button => {
        button.addEventListener('click', function() {
            const selectedAnswer = this.dataset.answer;
            
            // Disable all buttons to prevent multiple submissions
            optionButtons.forEach(btn => btn.disabled = true);

            fetch("{{ url_for('submit_answer') }}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    question_num: {{ question_num }},
                    answer: selectedAnswer
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update score
                    currentScore = data.score;
                    scoreDisplay.textContent = currentScore;

                    // Add visual feedback
                    this.classList.remove('btn-outline-primary');
                    if (data.correct) {
                        this.classList.add('btn-success');
                        setTimeout(() => {
                            {% if question_num < total_questions %}
                            window.location.href = "{{ url_for('quiz', question_num=question_num + 1) }}";
                            {% else %}
                            window.location.href = "{{ url_for('quiz_results') }}";
                            {% endif %}
                        }, 1000);
                    } else {
                        this.classList.add('btn-danger');
                        // Re-enable buttons for retry
                        setTimeout(() => {
                            optionButtons.forEach(btn => {
                                btn.disabled = false;
                                btn.classList.remove('btn-danger');
                                btn.classList.add('btn-outline-primary');
                            });
                        }, 1000);
                    }
                }
            });
        });
    });
});
</script>
{% endblock %} 